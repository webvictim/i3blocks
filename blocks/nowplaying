#!/bin/bash
DELAY=0.05
PLAYERCTL="playerctl --player spotify"

print_status() {
    pauseStatus=$(${PLAYERCTL}status 2>&1 | head -n1)
    if [[ "${pauseStatus}" == "No players found" || "${pauseStatus}" == "" ]]; then
        exit 0
    fi
    if [ $? -gt 0 ]; then
        exit 0
    fi
    if [[ "${pauseStatus}" == "Stopped" ]]; then
        exit 0
    fi
    artist=$(${PLAYERCTL} metadata artist)
    title=$(${PLAYERCTL} metadata title)
    spotifyStatus="${artist} | ${title}"
    pauseString=""
    if [[ "${pauseStatus}" == "Paused" ]]; then
        pauseString=" ÔÅå"
    fi

    echo "${spotifyStatus}${pauseString}"
    echo "${spotifyStatus}${pauseString}"
    echo ""    
}

# Left click
if [[ "${BLOCK_BUTTON}" -eq 1 ]]; then
    #qdbus org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.Next
    ${PLAYERCTL} next
    sleep ${DELAY}
# Middle click
elif [[ "${BLOCK_BUTTON}" -eq 2 ]]; then
    #qdbus org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.PlayPause
    ${PLAYERCTL} play-pause
    sleep ${DELAY}
# Right click
elif [[ "${BLOCK_BUTTON}" -eq 3 ]]; then
    #qdbus org.mpris.MediaPlayer2.spotify /org/mpris/MediaPlayer2 org.mpris.MediaPlayer2.Player.Previous
    ${PLAYERCTL} previous
    sleep ${DELAY}
fi

print_status
